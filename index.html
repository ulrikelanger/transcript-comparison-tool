<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transcript Comparison Tool</title>
    <meta name="description" content="Compare transcripts from different AI services side-by-side with visual differences highlighted">
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 1.1em;
        }
        
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }
        
        .tab {
            flex: 1;
            padding: 15px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s ease;
        }
        
        .tab.active {
            background: white;
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
        }
        
        .tab:hover:not(.active) {
            background: #e9ecef;
            color: #495057;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .upload-section {
            padding: 40px 30px;
            text-align: center;
            background: #f8f9fa;
        }
        
        .upload-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .upload-box {
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .upload-box:hover, .upload-box.dragover {
            border-color: #3498db;
            background: rgba(52, 152, 219, 0.05);
        }
        
        .upload-box input[type="file"] {
            display: none;
        }
        
        .upload-label {
            display: block;
            cursor: pointer;
            font-weight: 600;
            color: #495057;
            margin-bottom: 10px;
        }
        
        .file-info {
            font-size: 12px;
            color: #6c757d;
            margin-top: 10px;
        }
        
        .upload-box textarea {
            width: 100%;
            margin-top: 10px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            resize: vertical;
            font-family: inherit;
        }
        
        .controls {
            padding: 20px 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .control-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .control-group label {
            font-weight: 600;
            color: #495057;
        }
        
        .control-group input, .control-group select {
            padding: 8px 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
        }
        
        .btn-primary {
            background: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
        }
        
        .btn-success {
            background: #27ae60;
            color: white;
        }
        
        .btn-success:hover {
            background: #229954;
        }
        
        .btn-large {
            font-size: 18px;
            padding: 15px 30px;
        }
        
        .legend {
            display: flex;
            gap: 20px;
            margin-left: auto;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .legend-box {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }
        
        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            height: calc(100vh - 350px);
            min-height: 500px;
        }
        
        .transcript-panel {
            border-right: 1px solid #e9ecef;
            display: flex;
            flex-direction: column;
        }
        
        .transcript-panel:last-child {
            border-right: none;
        }
        
        .panel-header {
            background: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 1px solid #e9ecef;
            font-weight: 600;
            color: #495057;
            text-align: center;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .accuracy-score {
            background: #e9ecef;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .accuracy-high { background: #d4edda; color: #155724; }
        .accuracy-medium { background: #fff3cd; color: #856404; }
        .accuracy-low { background: #f8d7da; color: #721c24; }
        
        .transcript-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            line-height: 1.6;
            font-size: 14px;
        }
        
        .word {
            display: inline;
            margin: 1px;
            padding: 2px 0;
            border-radius: 3px;
            transition: all 0.2s ease;
        }
        
        .word:hover {
            background: rgba(52, 152, 219, 0.1);
            cursor: pointer;
        }
        
        .unique-1 {
            background: rgba(231, 76, 60, 0.2);
            border: 1px solid rgba(231, 76, 60, 0.4);
        }
        
        .unique-2 {
            background: rgba(46, 204, 113, 0.2);
            border: 1px solid rgba(46, 204, 113, 0.4);
        }
        
        .unique-3 {
            background: rgba(155, 89, 182, 0.2);
            border: 1px solid rgba(155, 89, 182, 0.4);
        }
        
        .common-text {
            background: rgba(241, 196, 15, 0.1);
        }
        
        .stats {
            padding: 20px 30px;
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .stat-item {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .stat-label {
            color: #7f8c8d;
            margin-top: 5px;
            font-size: 0.9em;
        }
        
        .search-highlight {
            background: rgba(255, 193, 7, 0.8) !important;
            border: 2px solid #ffc107 !important;
        }
        
        .export-section {
            padding: 20px 30px;
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #27ae60;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.error {
            background: #e74c3c;
        }
        
        .hidden {
            display: none !important;
        }
        
        @media (max-width: 1200px) {
            .comparison-grid {
                grid-template-columns: 1fr;
                height: auto;
            }
            
            .transcript-panel {
                border-right: none;
                border-bottom: 1px solid #e9ecef;
                min-height: 400px;
            }
            
            .transcript-panel:last-child {
                border-bottom: none;
            }
            
            .legend {
                margin-left: 0;
                margin-top: 15px;
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .upload-grid {
                grid-template-columns: 1fr;
            }
            
            .stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Transcript Comparison Tool</h1>
            <p>Compare transcripts from different AI services with advanced analysis</p>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab('demo')">Demo Comparison</button>
            <button class="tab" onclick="switchTab('upload')">Upload Your Own</button>
        </div>
        
        <div id="demo-content" class="tab-content active">
            <div class="controls">
                <div class="control-group">
                    <label for="searchInput">Search:</label>
                    <input type="text" id="searchInput" placeholder="Search across all transcripts...">
                </div>
                
                <div class="control-group">
                    <label for="viewMode">View Mode:</label>
                    <select id="viewMode" onchange="changeViewMode()">
                        <option value="differences">Show Differences</option>
                        <option value="clean">Clean View</option>
                        <option value="common">Common Words Only</option>
                    </select>
                </div>
                
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-box" style="background: rgba(231, 76, 60, 0.3);"></div>
                        <span>Unique to Service 1</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: rgba(46, 204, 113, 0.3);"></div>
                        <span>Unique to Service 2</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: rgba(155, 89, 182, 0.3);"></div>
                        <span>Unique to Service 3</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: rgba(241, 196, 15, 0.2);"></div>
                        <span>Common Text</span>
                    </div>
                </div>
            </div>
            
            <div class="comparison-grid">
                <div class="transcript-panel">
                    <div class="panel-header">
                        <span>Notta Transcript</span>
                        <span class="accuracy-score" id="accuracy-1">95%</span>
                    </div>
                    <div class="transcript-content" id="transcript-1"></div>
                </div>
                
                <div class="transcript-panel">
                    <div class="panel-header">
                        <span>Sonix Transcript</span>
                        <span class="accuracy-score" id="accuracy-2">87%</span>
                    </div>
                    <div class="transcript-content" id="transcript-2"></div>
                </div>
                
                <div class="transcript-panel">
                    <div class="panel-header">
                        <span>Otter.ai Transcript</span>
                        <span class="accuracy-score" id="accuracy-3">82%</span>
                    </div>
                    <div class="transcript-content" id="transcript-3"></div>
                </div>
            </div>
            
            <div class="export-section">
                <button class="btn btn-primary" onclick="exportComparison()">Export Analysis</button>
                <button class="btn btn-success" onclick="copyShareableLink()">Copy Shareable Link</button>
                <span>Share this comparison with others</span>
            </div>
        </div>
        
        <div id="upload-content" class="tab-content">
            <div class="upload-section">
                <h2>Upload Your Own Transcripts</h2>
                <p>Compare transcripts from your own files. Supports .txt files and direct text input.</p>
                
                <div class="upload-grid">
                    <div class="upload-box" onclick="document.getElementById('file1').click()">
                        <label class="upload-label" for="file1">Service 1 Transcript</label>
                        <input type="file" id="file1" accept=".txt" onchange="handleFileUpload(1)">
                        <div>üìÅ Click to upload or drag file here</div>
                        <div class="file-info" id="file1-info">No file selected</div>
                        <textarea id="text1" placeholder="Or paste transcript text here..." rows="4"></textarea>
                    </div>
                    
                    <div class="upload-box" onclick="document.getElementById('file2').click()">
                        <label class="upload-label" for="file2">Service 2 Transcript</label>
                        <input type="file" id="file2" accept=".txt" onchange="handleFileUpload(2)">
                        <div>üìÅ Click to upload or drag file here</div>
                        <div class="file-info" id="file2-info">No file selected</div>
                        <textarea id="text2" placeholder="Or paste transcript text here..." rows="4"></textarea>
                    </div>
                    
                    <div class="upload-box" onclick="document.getElementById('file3').click()">
                        <label class="upload-label" for="file3">Service 3 Transcript</label>
                        <input type="file" id="file3" accept=".txt" onchange="handleFileUpload(3)">
                        <div>üìÅ Click to upload or drag file here</div>
                        <div class="file-info" id="file3-info">No file selected</div>
                        <textarea id="text3" placeholder="Or paste transcript text here..." rows="4"></textarea>
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <button class="btn btn-primary btn-large" onclick="compareCustomTranscripts()">
                        üîç Compare Transcripts
                    </button>
                </div>
            </div>
        </div>
        
        <div class="stats">
            <div class="stat-item">
                <div class="stat-value" id="words-1">0</div>
                <div class="stat-label">Service 1 Words</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="words-2">0</div>
                <div class="stat-label">Service 2 Words</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="words-3">0</div>
                <div class="stat-label">Service 3 Words</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="similarity">0%</div>
                <div class="stat-label">Overall Similarity</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="unique-words">0</div>
                <div class="stat-label">Unique Words Total</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="common-words">0</div>
                <div class="stat-label">Common Words</div>
            </div>
        </div>
    </div>
    
    <div id="notification" class="notification"></div>

    <script>
        // Default demo transcripts (your original data)
        const demoTranscripts = {
            transcript1: `The bundle of the future, it's a mix of a new site and it's also an e-paper and the user design is inspired by Instagram, if I got it right, so he will explain us now I hope how this works. Everyone wants to sit, but then it's a risk of not getting away. You have to stay and don't get. I like to talk about the new product we launched and strangely enough I like to start by explaining what it is not. It's not an e-paper and it's not an app and a website. It's something in between. It's a collection like stack cards, a collection of content. It can be audio, video, stories, text, everything with the beginning and the end and we can play that collection. We call it the bundle of the future. It wasn't in the program but we started it. We can distribute it on our own app, on social via WhatsApp within an article basically everywhere. Even in searchable via Google, you can enter directly in this bundle of the future. It's a product with the beginning and the end and it's the idea behind it that it's not created for our current audience. Of course they are able to read it and can enter the product but we started thinking we have to come up with something with the beginning and a bundle, a curated bundle by everyone. We have to find an answer for the future audience, and then we'd like to talk between 30 and 30 new audience for our current brands, and they are not going to read print, but they are also not going to read digital e-makers. We know by our data, they are not interested in this digital e-maker. They are not used to this product. They didn't group with it on the kitchen table, so basically they don't understand our current model. So we have to come up with some new, informal model, and that's what we call the model of the future.`,
            
            transcript2: `Bundle of the future. It's a mix of a new site, and it's also an e paper. And the the user design is inspired by Instagram, which I got that right. So he will explain now I hope how this works. For. You. There are some places. Anyone wants to sit. But then it's a risk of not getting away. You have to stay until the end. I like to talk about a new product we launched. And strangely enough, I'd like to start by explaining what it is not. It's not an e paper, and it's not an app and a website. It's something in between. It's a collection MacTaggart. A collection of content can be audio, video, stories, text, everything with a beginning and end. And we can play that collection. We call it the bundle of the future, plus the name of the program when we started it. We can distribute it on our own app, on social, via WhatsApp, within an article, basically everywhere you can searchable via Google and you can enter directly in this bundle for future. It's a product with the beginning and end, and it's the idea behind it that it's created for our current audience. Of course, they are able to read it and can enter the product, but we started thinking we have to come up with something with the beginning end to a curated bundle by editors and what I manually created product and it was started quickly. We have to find an answer for the future audience, and then we like to call between 30 and 50 new audience for our current brands. And they are not going to reprint, but they are also not going to read digital impact. We know final data. They are not interested in this digital feedback.`,
            
            transcript3: `The bundle of the future. It's a mix of the news sites, and it's also an E paper, and the user design is inspired by Instagram, if I got it right. So he will explain us now, I hope how this works. You. A number. Anyone wants to sit, but then it's a risk of not getting away. You have to stay and don't yet, I like to talk about a new product we launched, and strangely enough, I like to start by explaining what it is not. It's not an E paper and it's not an app and a website. It's something in between. It's a collection like stack cards. A collection of content can be audio, video, stories, text, everything with the beginning and end, and we can play that collection. We call it the bottom of the future was the name of the program when we started it, we can distribute it on our own app, on social, via WhatsApp, within an article, basically everywhere, even it's searchable via Google, then you can end up directly in this bundle of the future. It's a product with the beginning and end, and it's the idea behind it, that it's created for our current audience. Of course, they are able to read it and can enter the product. But we started thinking, we have to come up with something with the beginning and end, a bundle, a curated bundle, by editor, by AI manually created product, and it's started quickly. We have to find an answer for the future audience, and then we like to talk between 30 and 50 new audience for our current brands, and they are not going to read print, but they are also not going to read digital e papers. We know I have data. They are not interested in this digital e paper. They are not used to this product. They didn't grow up with it on the kitchen table. So basically, they don't understand our current model. So we have to come up with some new bundle, and that's what we call the bundle of the future.`
        };

        let currentTranscripts = { ...demoTranscripts };
        let currentAnalysis = null;

        function normalizeText(text) {
            return text.toLowerCase()
                .replace(/[^\w\s]/g, ' ')
                .replace(/\s+/g, ' ')
                .trim();
        }

        function getWords(text) {
            return normalizeText(text).split(' ').filter(word => word.length > 0);
        }

        function findUniqueAndCommon() {
            const words1 = getWords(currentTranscripts.transcript1);
            const words2 = getWords(currentTranscripts.transcript2);
            const words3 = getWords(currentTranscripts.transcript3);

            const allWords = new Set([...words1, ...words2, ...words3]);
            
            const analysis = {
                unique1: new Set(),
                unique2: new Set(),
                unique3: new Set(),
                common: new Set(),
                partial: new Set()
            };

            allWords.forEach(word => {
                const inT1 = words1.includes(word);
                const inT2 = words2.includes(word);
                const inT3 = words3.includes(word);

                if (inT1 && inT2 && inT3) {
                    analysis.common.add(word);
                } else if (inT1 && !inT2 && !inT3) {
                    analysis.unique1.add(word);
                } else if (inT2 && !inT1 && !inT3) {
                    analysis.unique2.add(word);
                } else if (inT3 && !inT1 && !inT2) {
                    analysis.unique3.add(word);
                } else {
                    analysis.partial.add(word);
                }
            });

            return analysis;
        }

        function highlightText(text, analysis, transcriptNum) {
            const words = text.split(/(\s+)/);
            return words.map(word => {
                if (/^\s+$/.test(word)) return word;
                
                const normalizedWord = normalizeText(word);
                let className = '';
                
                if (analysis.common.has(normalizedWord)) {
                    className = 'common-text';
                } else if (transcriptNum === 1 && analysis.unique1.has(normalizedWord)) {
                    className = 'unique-1';
                } else if (transcriptNum === 2 && analysis.unique2.has(normalizedWord)) {
                    className = 'unique-2';
                } else if (transcriptNum === 3 && analysis.unique3.has(normalizedWord)) {
                    className = 'unique-3';
                }
                
                return className ? `<span class="word ${className}">${word}</span>` : word;
            }).join('');
        }

        function calculateAccuracy() {
            const analysis = currentAnalysis || findUniqueAndCommon();
            const totalUnique1 = analysis.unique1.size;
            const totalUnique2 = analysis.unique2.size;
            const totalUnique3 = analysis.unique3.size;
            const totalCommon = analysis.common.size;
            
            const accuracy1 = Math.round(((totalCommon + analysis.partial.size) / (totalCommon + totalUnique1 + analysis.partial.size)) * 100);
            const accuracy2 = Math.round(((totalCommon + analysis.partial.size) / (totalCommon + totalUnique2 + analysis.partial.size)) * 100);
            const accuracy3 = Math.round(((totalCommon + analysis.partial.size) / (totalCommon + totalUnique3 + analysis.partial.size)) * 100);
            
            return { accuracy1, accuracy2, accuracy3 };
        }

        function updateAccuracyDisplay() {
            const { accuracy1, accuracy2, accuracy3 } = calculateAccuracy();
            
            function getAccuracyClass(score) {
                if (score >= 90) return 'accuracy-high';
                if (score >= 80) return 'accuracy-medium';
                return 'accuracy-low';
            }
            
            document.getElementById('accuracy-1').textContent = accuracy1 + '%';
            document.getElementById('accuracy-1').className = 'accuracy-score ' + getAccuracyClass(accuracy1);
            
            document.getElementById('accuracy-2').textContent = accuracy2 + '%';
            document.getElementById('accuracy-2').className = 'accuracy-score ' + getAccuracyClass(accuracy2);
            
            document.getElementById('accuracy-3').textContent = accuracy3 + '%';
            document.getElementById('accuracy-3').className = 'accuracy-score ' + getAccuracyClass(accuracy3);
        }

        function calculateSimilarity() {
            const words1 = getWords(currentTranscripts.transcript1);
            const words2 = getWords(currentTranscripts.transcript2);
            const words3 = getWords(currentTranscripts.transcript3);
            
            const allWords = new Set([...words1, ...words2, ...words3]);
            const commonWords = [];
            
            allWords.forEach(word => {
                if (words1.includes(word) && words2.includes(word) && words3.includes(word)) {
                    commonWords.push(word);
                }
            });
            
            return Math.round((commonWords.length / allWords.size) * 100);
        }

        function updateStats() {
            const analysis = currentAnalysis || findUniqueAndCommon();
            
            document.getElementById('words-1').textContent = getWords(currentTranscripts.transcript1).length;
            document.getElementById('words-2').textContent = getWords(currentTranscripts.transcript2).length;
            document.getElementById('words-3').textContent = getWords(currentTranscripts.transcript3).length;
            document.getElementById('similarity').textContent = calculateSimilarity() + '%';
            document.getElementById('unique-words').textContent = analysis.unique1.size + analysis.unique2.size + analysis.unique3.size;
            document.getElementById('common-words').textContent = analysis.common.size;
            
            updateAccuracyDisplay();
        }

        function highlightSearch(searchTerm) {
            [1, 2, 3].forEach(num => {
                const content = document.getElementById(`transcript-${num}`);
                const text = content.innerHTML;
                
                const cleanText = text.replace(/<span class="search-highlight">(.*?)<\/span>/g, '$1');
                
                if (searchTerm.trim()) {
                    const regex = new RegExp(`(${searchTerm.trim()})`, 'gi');
                    const highlighted = cleanText.replace(regex, '<span class="search-highlight">$1</span>');
                    content.innerHTML = highlighted;
                } else {
                    content.innerHTML = cleanText;
                }
            });
        }

        function changeViewMode() {
            const mode = document.getElementById('viewMode').value;
            const analysis = currentAnalysis || findUniqueAndCommon();
            
            [1, 2, 3].forEach(num => {
                const content = document.getElementById(`transcript-${num}`);
                const transcriptKey = `transcript${num}`;
                
                switch(mode) {
                    case 'clean':
                        content.innerHTML = currentTranscripts[transcriptKey];
                        break;
                    case 'common':
                        content.innerHTML = highlightCommonOnly(currentTranscripts[transcriptKey], analysis);
                        break;
                    default:
                        content.innerHTML = highlightText(currentTranscripts[transcriptKey], analysis, num);
                }
            });
        }

        function highlightCommonOnly(text, analysis) {
            const words = text.split(/(\s+)/);
            return words.map(word => {
                if (/^\s+$/.test(word)) return word;
                
                const normalizedWord = normalizeText(word);
                if (analysis.common.has(normalizedWord)) {
                    return `<span class="word common-text">${word}</span>`;
                } else {
                    return `<span style="opacity: 0.3;">${word}</span>`;
                }
            }).join('');
        }

        function switchTab(tabName) {
            // Remove active class from all tabs and content
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Add active class to selected tab and content
            event.target.classList.add('active');
            document.getElementById(`${tabName}-content`).classList.add('active');
        }

        function handleFileUpload(fileNum) {
            const fileInput = document.getElementById(`file${fileNum}`);
            const fileInfo = document.getElementById(`file${fileNum}-info`);
            const file = fileInput.files[0];
            
            if (file) {
                fileInfo.textContent = `${file.name} (${(file.size / 1024).toFixed(1)} KB)`;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    let text = e.target.result;
                    document.getElementById(`text${fileNum}`).value = text;
                };
                
                reader.readAsText(file);
            } else {
                fileInfo.textContent = 'No file selected';
            }
        }

        function compareCustomTranscripts() {
            const text1 = document.getElementById('text1').value.trim();
            const text2 = document.getElementById('text2').value.trim();
            const text3 = document.getElementById('text3').value.trim();
            
            if (!text1 && !text2 && !text3) {
                showNotification('Please provide at least one transcript to compare.', 'error');
                return;
            }
            
            // Fill empty transcripts with placeholder text
            currentTranscripts.transcript1 = text1 || 'No transcript provided for Service 1.';
            currentTranscripts.transcript2 = text2 || 'No transcript provided for Service 2.';
            currentTranscripts.transcript3 = text3 || 'No transcript provided for Service 3.';
            
            // Switch to demo tab to show results
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.querySelector('[onclick="switchTab(\'demo\')"]').classList.add('active');
            document.getElementById('demo-content').classList.add('active');
            
            // Update the comparison
            initComparison();
            showNotification('Custom transcripts loaded successfully!', 'success');
        }

        function exportComparison() {
            const analysis = currentAnalysis || findUniqueAndCommon();
            const { accuracy1, accuracy2, accuracy3 } = calculateAccuracy();
            
            const reportData = {
                timestamp: new Date().toISOString(),
                transcripts: currentTranscripts,
                statistics: {
                    wordCounts: {
                        service1: getWords(currentTranscripts.transcript1).length,
                        service2: getWords(currentTranscripts.transcript2).length,
                        service3: getWords(currentTranscripts.transcript3).length
                    },
                    accuracy: { accuracy1, accuracy2, accuracy3 },
                    similarity: calculateSimilarity(),
                    uniqueWords: analysis.unique1.size + analysis.unique2.size + analysis.unique3.size,
                    commonWords: analysis.common.size
                },
                analysis: {
                    uniqueToService1: Array.from(analysis.unique1),
                    uniqueToService2: Array.from(analysis.unique2),
                    uniqueToService3: Array.from(analysis.unique3),
                    commonWords: Array.from(analysis.common)
                }
            };
            
            const blob = new Blob([JSON.stringify(reportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `transcript-comparison-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Analysis exported successfully!', 'success');
        }

        function copyShareableLink() {
            const encodedData = btoa(JSON.stringify(currentTranscripts));
            const shareableUrl = `${window.location.origin}${window.location.pathname}?data=${encodedData}`;
            
            navigator.clipboard.writeText(shareableUrl).then(() => {
                showNotification('Shareable link copied to clipboard!', 'success');
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = shareableUrl;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showNotification('Shareable link copied to clipboard!', 'success');
            });
        }

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type === 'error' ? 'error' : ''}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function loadFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            const encodedData = urlParams.get('data');
            
            if (encodedData) {
                try {
                    const decodedData = JSON.parse(atob(encodedData));
                    currentTranscripts = decodedData;
                    showNotification('Shared comparison loaded!', 'success');
                } catch (e) {
                    console.error('Failed to load shared data:', e);
                }
            }
        }

        function initComparison() {
            currentAnalysis = findUniqueAndCommon();
            
            document.getElementById('transcript-1').innerHTML = highlightText(currentTranscripts.transcript1, currentAnalysis, 1);
            document.getElementById('transcript-2').innerHTML = highlightText(currentTranscripts.transcript2, currentAnalysis, 2);
            document.getElementById('transcript-3').innerHTML = highlightText(currentTranscripts.transcript3, currentAnalysis, 3);
            
            updateStats();
            
            // Add search functionality
            document.getElementById('searchInput').addEventListener('input', (e) => {
                highlightSearch(e.target.value);
            });
        }

        // Add drag and drop functionality
        function setupDragAndDrop() {
            [1, 2, 3].forEach(num => {
                const uploadBox = document.querySelector(`#file${num}`).closest('.upload-box');
                
                uploadBox.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadBox.classList.add('dragover');
                });
                
                uploadBox.addEventListener('dragleave', () => {
                    uploadBox.classList.remove('dragover');
                });
                
                uploadBox.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadBox.classList.remove('dragover');
                    
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        document.getElementById(`file${num}`).files = files;
                        handleFileUpload(num);
                    }
                });
                
                // Prevent textarea clicks from triggering file upload
                uploadBox.querySelector('textarea').addEventListener('click', (e) => {
                    e.stopPropagation();
                });
            });
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            loadFromUrl();
            initComparison();
            setupDragAndDrop();
        });
    </script>
</body>
</html>
